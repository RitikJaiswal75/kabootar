<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Sharing Platform</title>
    <style>
      :root {
        /* Primary Colors */
        --primary-blue: #1e88e5;
        --accent-cyan: #00acc1;

        /* Background & Surfaces */
        --bg-primary: #121212;
        --bg-secondary: #1e1e1e;
        --bg-card: #232323;

        /* Text Colors */
        --text-primary: #e0e0e0;
        --text-secondary: #bdbdbd;
        --text-disabled: #757575;

        /* Borders & Dividers */
        --border-soft: #333333;
        --border-emphasized: #424242;

        /* Status Colors */
        --success-green: #66bb6a;
        --warning-yellow: #ffca28;
        --error-red: #e53935;
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--bg-primary);
        color: var(--text-primary);
      }
      nav {
        background-color: var(--primary-blue);
        color: var(--text-primary);
        padding: 1rem;
        font-size: 1.5rem;
      }
      .container {
        max-width: 600px;
        margin: 2rem auto;
        padding: 2rem;
        background: var(--bg-card);
        color: var(--text-primary);
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      h1 {
        text-align: center;
        margin-bottom: 1rem;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      input[type="file"] {
        padding: 0.5rem;
        border: 1px solid var(--border-soft);
        border-radius: 4px;
      }
      input[type="submit"] {
        background-color: var(--primary-blue);
        color: var(--text-primary);
        border: none;
        padding: 0.75rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
      }
      input[type="submit"]:not(:disabled):hover {
        background-color: var(--accent-cyan);
      }
      .message {
        margin-top: 1rem;
        text-align: center;
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <nav>FileShare | Securely Share Your Files</nav>
    <div class="container">
      <h1>Upload Your Files</h1>
      <form method="post" onsubmit="myFunc(event)" id="form"></form>
      <div class="message" id="message"></div>

      <div class="instructions">
        <h2>How to Use</h2>
        <ol>
          <li>
            Ensure that both devices (sender and receiver) are connected to the
            same local network (e.g., Wi-Fi).
          </li>
          <li>
            On the receiver device, open this application in a web browser.
          </li>
          <li>
            Locate the URL displayed below. This is the address of the
            file-sharing platform on your local network:
          </li>
          <div style="display: flex; align-items: center; gap: 0.5rem">
            <input
              type="text"
              id="urlInput"
              value=""
              readonly
              style="
                flex: 1;
                padding: 0.5rem;
                border: 1px solid var(--border-soft);
                border-radius: 4px;
              "
            />
          </div>
          <li>
            On the sender device, open a web browser and paste the copied URL
            into the address bar to access the platform.
          </li>
          <li>Use the file upload form to select and upload files securely.</li>
        </ol>
      </div>
    </div>
    <script>
      // Set the current window location in the input field
      document.getElementById("urlInput").value =
        window.location.origin + window.location.pathname;

      // Function to copy the URL to clipboard
      function copyToClipboard() {
        const urlInput = document.getElementById("urlInput");
        urlInput.select();
        urlInput.setSelectionRange(0, 99999); // For mobile devices
        document.execCommand("copy");
      }
    </script>
    <script>
      let form = document.getElementById("form");

      const innerForm = `<input type="file" name="files" multiple id="files" />
        <input type="submit" value="Upload" id="uploadButton" />`;

      // Parse query parameters and display them in the console
      const queryParams = new URLSearchParams(window.location.search);
      console.log(queryParams.get("role"));
      queryParams.get("role") !== "sender"
        ? (form.innerHTML = innerForm)
        : null;

      function myFunc(e) {
        e.preventDefault();
        const messageDiv = document.getElementById("message");
        messageDiv.textContent = ""; // Clear previous messages
        const uploadButton = document.getElementById("uploadButton");
        let formData = new FormData(form);
        const xhr = new XMLHttpRequest();

        uploadButton.disabled = true;
        xhr.open("POST", "/", true);

        xhr.upload.onprogress = function (event) {
          if (event.lengthComputable) {
            let percent = (event.loaded / event.total) * 100;
            messageDiv.innerText = `Uploading... ${Math.round(percent)}%`;
          }
        };

        xhr.onload = function () {
          if (xhr.status === 201) {
            messageDiv.innerText = "Upload Complete!";
          } else {
            messageDiv.innerText = "Upload Failed!";
          }
          uploadButton.disabled = false;
        };

        // Send file
        xhr.send(formData);
      }
    </script>
  </body>
</html>
